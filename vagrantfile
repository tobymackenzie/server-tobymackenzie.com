Vagrant.require_version '>= 1.7.0'

Vagrant.configure(2) do |config|
	config.vm.box = 'ubuntu/bionic64'

	#==network
	config.vm.network 'private_network', ip: '10.9.8.7'
	#--connect to internet
	#-@ https://stackoverflow.com/a/18457420/1139122
	config.vm.provider 'virtualbox' do |vb|
		vb.customize ['modifyvm', :id, '--natdnshostresolver1', 'on']
		vb.customize ['modifyvm', :id, '--natdnsproxy1', 'on']
	end

	#==provision
	#-@ [official](http://docs.ansible.com/ansible/guide_vagrant.html)
	config.vm.provision 'ansible' do |ansible|
		ansible.verbose = 'v'
		ansible.playbook = 'provision/dev.yml'
	end

	#==sync local folders
	#--sites
	vagrantRoot = File.dirname(__FILE__)
	#-# couldn't get `exclude-file` to work, so parse em
	excludeFile = File.open(vagrantRoot + '/provision/sync/sites.exclude', 'r')
	excludes = excludeFile.read().split("\n")
	excludeFile.close()
	config.vm.synced_folder 'sites/', '/var/www/sites', create: true, rsync__args: ['--copy-unsafe-links', '--delete', '--links', '--perms', '--recursive', '--times', '-z'], rsync__auto: false, rsync__exclude: excludes, type: 'rsync'
	#--disable syncing project folder
	config.vm.synced_folder '.', '/vagrant', disabled: true
end
